# myMiniftp
实现了一个ftp功能的双向文件传输服务，所有功能都可以看作是客户端和服务器之间的交互：
上传与下载，即一端读取文件内容一端写入文件内容的操作， 
断点续传（上传或下载）便维护一个offset， 用lseek函数定位初始位置；
其他基础的诸如文件列表的传输，用户名用户密码的确认都是基于客户端与服务端的交互

我们知道ftp最重要的就是有  主动模式和被动模式 两种模式
主动模式下，是客户端创建套接字，服务端绑定20端口与connect客户端
被动模式下，服务端创建套接字，客户端发起连接，服务端accept

这个主动模式与被动模式都是需要数据传输时才需要考虑的问题

FTP是一个会话交互系统session，客户端每次连接FTP服务端都会建立控制连接， 发起传输数据文件请求时与服务端建立数据连接， 而出于数据传输的可靠性与安全性保证，服务器是由父子进程共同实现，子进程对外进行控制连接，当需要数据传输时，由父进程nobody去与客户端连接，在socket上进行数据传输
因此在这个基础上，FTP服务端又需要父子进程可以通信，通过sockpair()进行通信，privsock.c中就是两个进程通信的方法实现


如上段所述，对外的交互都是由子进程实现的，所以能实现的函数在ftpproto.c中实现，只不过是需要有父进程nobody的协助了，才会通过privsock的通信函数向父进程发送命令（带着必要的参数），父进程在privparent.c中进行connect或者accept之后，将结果返回给子进程，再由子进程对外交互


另外实现了连接数限制、限速功能和abor：
客户端连接个数的限制分为两部分的限制：一是总用户的连接数和每ip的连接数，总用户的连接数就是子进程的数目，与配置文件中最大连接数进行比较即可； 每ip数的维护我们创建一个ip与连接数量的哈希表，每次有新的客户端连接就在那个ip对应位置的数量+1，当客户端退出的时候，我们需要用第二个进程与ip的哈希表来得知退出客户端的ip，再在第一个客户端中进行-1操作
限速本质就是让快的进程睡眠一定时间
abor，需要开启紧急模式void activate__oobinline(int fd), 开启一个能接收SIGURG信号, 接收信号判断是否是ABOR， 是就退出

最后呢，代码模块简单介绍一下：
common.h是所有需要的系统头文件
sysutil 是系统工具模块，比如数据按行读，对指定端口进行连接，获取时间等
ftpcodes：父子进程之间，客户端与服务端之间在给出命令之后，不管什么结果都需要给一个回应，这就是回应的宏
ftpproto.c：子进程的处理(服务器对外能做的事的所有函数
hash ：客户端连接数限制中用
miniftpd.conf：配置项
parseconf ：解析配置项
privparent ：父进程的处理
privsock: 父子进程的通信函数，要发送结果啦，发送fd啦，发送命令啦等等
session：begin_session()函数，故事开始的地方， 会话的结构内容，父子进程要做的事handle_parent()、handle_child()
str:对字符串的各种操作函数，像配置项还有命令都是字符串，解析的时候是要对字符串进行处理的，比如对等号前后进行分割， 去掉字符串的\r\n
tunable:给配置项一些初始值



嗷，配置项放在守护进程中






当然，本项目的实现需要依托FTP工具，我用的是VSFTP
Implementation of imitating VSFTP
详细的分析介绍会在https://blog.csdn.net/qq_37299596/article/details/107152371 
（觉得各功能实现已经比较清楚了，可能就将自己还有点模棱两可的理清楚，一些基础概念再扎实一下
